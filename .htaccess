#Make sure .htaccess files aren't disabled.

#Apache will serve files with a different charset, and break unicode characters, unless this is set.
AddDefaultCharset UTF-8

# Redirect HTTP connections to HTTPS
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
</IfModule>

#Strict transport security - force https in future.
Header always set Strict-Transport-Security "max-age=63072000; preload; includeSubdomains" env=HTTPS

#Allow usgscache to be loaded by dev site and rivers.run. This is a bit too lax, but whatever.
<FilesMatch "\.(json)$">
Header set Access-Control-Allow-Origin *
Header set Access-Control-Expose-Headers Date
</FilesMatch>


#Block all access to data directory.
RedirectMatch 403 ^/data/.*$


#Images can be cached for 5 days. Serve up to 100 days old if errors.
<FilesMatch "\.(png|jpeg)$">
Header set Cache-Control "max-age=432000, public, stale-if-error=8640000"
</FilesMatch>

#Make sure the site stays up to date. 12 hour cache for javascript, html, and css, but up to 100 days old if errors.
<FilesMatch "\.(js|css|html)$">
Header set Cache-Control "max-age=43200, public, stale-if-error=8640000"
</FilesMatch>

#5 minute cache. Serve up to 1 day old if errors.
<FilesMatch "usgscache.json">
Header set Cache-Control "max-age=300, public, stale-if-error=86400"
</FilesMatch>

#1 day cache. Serve up to 100 days old if errors.
<FilesMatch "(riverarray.js|manifest.json)">
Header set Cache-Control "max-age=86400, public, stale-if-error=8640000"
</FilesMatch>

#3 day cache (overviews don't change much). Serve up to 100 days old if errors.
<FilesMatch "overviews.js">
Header set Cache-Control "max-age=259200, public, stale-if-error=8640000"
</FilesMatch>



SetOutputFilter DEFLATE
#TODO: Make sure to use deflate compression level 9. Levels are 0-9

#TODO: Implement brotli compression.
#SetOutputFilter BROTLI_COMPRESS
#Make sure to use brotli compression level 9. Levels are 0-11, but 10 and 11 are FAR slower.

#TODO: Implement http/2 server push.
