{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/@babel/runtime/helpers/typeof.js","webpack:///./virtualGaugeCalculator.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","_typeof2","obj","iterator","constructor","_typeof","window","addEventListener","event","origin","location","console","log","mainWindow","source","data","type","usgsarray","postMessage","result","usgsSites","requestedSites","length","code","options","text","parameters","undefined","concat","blob","Blob","url","URL","createObjectURL","worker","Worker","Promise","resolve","reject","onmessage","message","finished","content","configurable","writable","init","runBackground","then","_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_0___default","keys","includes","warn","gaugeID"],"mappings":"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","file":"virtualGaugeCalculator.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 15);\n","function _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","//This script should be transpiled, then put into the script tag in virtualGaugeCalculator.html\n\n\n//The scope that the messages are broadcast to will need to be checked. Multiple open rivers.run tabs may cause excessive workloads otherwise.\n\n//code is the function (or stringified function) to be run.\n//options can contain the following properties:\n\t//parameters - Used to pass parameters to the function that is being run.\n\nfunction runBackground(code, options) {\n\n\tlet text;\n\tlet obj = {}\n\n\n\tlet parameters = options.parameters || [];\n\n\t//Allow the user to pass just a single parameter\n\tif (parameters.length === undefined || typeof parameters === \"string\") {\n\t\tparameters = [parameters]\n\t}\n\n\tconsole.log(parameters)\n\n\t//TODO: Replace async/await with promises.\n\ttext = `\nself.onmessage = function(parameters) {\n\tparameters = parameters.data\n\tlet result = (${code})(...parameters);\n\tpostMessage({\n\t\ttype:\"message\",\n\t\tfinished:true,\n\t\tcontent:result\n\t})\n}`\n\tconsole.log(text)\n\n\n\n\tlet blob = new Blob([text])\n\tlet url = URL.createObjectURL(blob)\n\n\n\t//obj.onmessage and obj.onerror should be used instead of obj.worker.onmessage\n\n\tobj.worker = new Worker(url)\n\n\t//The worker doesn't actually activate until obj.init() is called.\n\tobj.result = new Promise(function(resolve,reject){\n\n\t\t//Handle messages from worker\n\t\tobj.worker.onmessage = function(message) {\n\n\t\t\tmessage = message.data\n\n\t\t\tif (message.finished) {\n\t\t\t\t//Return the final value\n\t\t\t\tresolve(message.content)\n\t\t\t}\n\t\t\telse if (obj.onmessage) {\n\t\t\t obj.onmessage(message)\n\t\t\t}\n\n\t\t}\n\n\t\t//Force people to use obj.onmessage instead of obj.worker.onmessage\n\t\t//We don't want them overwriting our listeners\n\n\t\tObject.defineProperty(obj.worker, \"onmessage\", {\n\t\t\tconfigurable:false,\n\t\t\twritable: false,\n\t\t\tvalue: obj.worker.onmessage //If I inlined the function here, it wasnt working\n\t\t})\n\n\t})\n\n\tobj.init = function() {\n\t\tobj.worker.postMessage(parameters)\n\t\tdelete obj.init;\n\t\treturn obj; //Allow chaining\n\t}\n\n\n\treturn obj;\n}\n\n\nwindow.addEventListener('message', function (event) {\n  if (event.origin !== window.location.origin) {\n\tconsole.log(event.origin + \" is not permitted to use this iframe.\")\n\treturn \"Your origin is not permitted to use this iframe\";\n  }\n\n  var mainWindow = event.source;\n  var data = event.data\n\n  console.log(event)\n\n  if (event.data.type === \"usgsarray\") {\n\t  //TODO: Lock out old calculations when this changes.\n\t  window.usgsarray = event.data.data\n\t  mainWindow.postMessage({type: \"confirmation\", result:\"usgsarray\"}, event.origin);\n\t  console.log(window.usgsarray)\n  }\n  else if (event.data.type === \"calculation\") {\n\t  let usgsSites = event.data.usgsSites\n\t  let requestedSites = {}\n\t  for (let i=0;i<usgsSites.length;i++) {\n\t\t  requestedSites[usgsSites[i]] = usgsarray[usgsSites[i]]\n\t  }\n\t  console.log(requestedSites)\n\t  runBackground(event.data.function, {parameters: [requestedSites]}).init().result.then((result) => {\n\t\t  //Unnesssasary sanitatiion\n\t\t  if (typeof result !== \"object\" || !result) {\n\t\t\t  result = undefined\n\t\t\t  console.warn(event.data.gaugeID + \" failed to return an object, and instead returned \" + result)\n\t\t  }\n\t\t  else {\n\t\t\t  let keys = Object.keys(result)\n\t\t\t  for (let i=0;i<keys.length;i++) {\n\t\t\t\t  if (![\"00060\", \"00065\"].includes(keys[i])) {\n\t\t\t\t\t  console.warn(event.data.gaugeID + \" returned a property named \" + keys[i] + \", which is not allowed.\")\n\t\t\t\t\t  delete result[keys[i]]\n\t\t\t\t  }\n\t\t\t  }\n\t\t\t  result.name = event.data.gaugeID\n\t\t\t  usgsarray[event.data.gaugeID] = result\n\t\t  }\n\t\t  mainWindow.postMessage({type:\"calculation\", gaugeID: event.data.gaugeID, result}, event.origin);\n\t  })\n  }\n});\n"],"sourceRoot":""}