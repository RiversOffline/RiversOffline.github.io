<h2>Notice: This may generate an invalid writeup. It has not yet been tested.</h2>


<p>Your progress in creating this writeup is automatically saved. It will be available the next time this page is loaded, unless one of the following occours:<br>
1. localStorage is cleared. Browsers may do this if you click "clear cache" or "clear cookies and other side data".<br>
2. Multiple tabs of this page open at once - The tabs will overwrite each other.</p>
<br><br>

<p>The 3 Fields below this may not apply to all rivers. Don't worry. You can leave them blank.</p>
<input id="usgs" type="text" placeholder="USGS Gauge Number"  style="width:100%">
<br>
<input id="relatedusgs" type="text" placeholder="Related USGS Gauges (comma seperated list)"  style="width:100%">
<br>
<textarea hidden id="virtualgauge" type="text" placeholder="Virtual Gauge Code"  style="width:100%"></textarea>
<br>
<p>You <strong>MUST</strong> put either ft, feet, or cfs after the value (ex. 1.67ft, 1992cfs, 3.91 ft, 391 cfs, 2.42 feet).</p>
<input id="minrun" type="text" placeholder="Minimum runnable water level"  style="width:100%">
<br>
<input id="maxrun" type="text" placeholder="Maximum runnable water level"  style="width:100%">
<br>
<input id="lowflow" type="text" placeholder="Low Water"  style="width:100%">
<br>
<input id="medflow" type="text" placeholder="Ideal Level"  style="width:100%">
<br>
<input id="highflow" type="text" placeholder="High Water"  style="width:100%">
<br>
<p>Either input coordinates in decimal format, or press the convert coordinates button to convert them. If you see NaN, email admin@rivers.run with the coordinates. </p>
<input id="plat" type="text" placeholder="Put-in GPS Latitude"  style="width:100%">
<br>
<input id="plon" type="text" placeholder="Put-in GPS Longitude"  style="width:100%">
<br>
<input id="tlat" type="text" placeholder="Take-out GPS Latitude"  style="width:100%">
<br>
<input id="tlon" type="text" placeholder="Take-out GPS Longitude"  style="width:100%">
<br>
<button onclick="convertCoordinates()">Convert Coordinates</button>
<br>
<p><strong>IF YOU DID NOT INPUT PUT-IN OR TAKEOUT GPS:</strong></p>
<input id="hidlat" type="text" placeholder="Approxtimate GPS Longitude"  style="width:100%">
<input id="hidlon" type="text" placeholder="Approxtimate GPS Longitude"  style="width:100%">
<p>GPS coordinites that you input in the 2 boxes above will not be shown to the user, however will be used in GPS sorting.</p>
<br><br>
<input id="aw" type="text" placeholder="AW River Number"  style="width:100%">
<br>
<input id="dam" type="text" placeholder="Link to dam information"  style="width:100%">
<br>
<input id="tags" type="text" placeholder="Input Tags Here, seperated by commas"  style="width:100%">
<br>
<p>Tag Examples: CCCWOR, Ice-Cream, Monacacy, NC, PA, TN, CA, MI, WV, ext.
<br>
Put C1 after the tag if you can get to the river within an hour from that area (ex. CCCWORC1), put C if you can get to the river in 1-2 hours from that area (ex. CCCWORC), and put nothing if it takes 2+ hours (ex. CCCWOR). Do not put the tag if it is unreasonable to paddle the river from the area.</p>
<br>
<input id="name" type="text" placeholder="River Name"  style="width:100%">
<br>
<input id="section" placeholder="Section Name" type="text"  style="width:100%">
<br>
<select id="skill" onchange="UpdateWriteup()">
  <option value="">Skill</option>
  <option value="FW">Flat Water</option>
  <option value="B">Beginner</option>
  <option value="N">Novice</option>
  <option value="LI">Low-Intermediate</option>
  <option value="I">Intermediate</option>
  <option value="HI">High-Intermediate</option>
  <option value="A">Advanced</option>
  <option value="E">Expert</option>
</select>
<br>
<input id="class" placeholder="Class (currently not used, likely will be in future)" type="text"  style="width:100%">
<br>
<select id="rating" onchange="UpdateWriteup()">
  <option selected value="">Rating</option>
</select>

<script>
	var rating = document.getElementById("rating")
	for (let i=4;i<21;i++) {
		let stars = i/4
		let option = document.createElement("option")
		option.value = stars
		option.innerHTML = stars + " Stars"
		rating.appendChild(option)
	}
</script>
<br><br>



<!-- Quill can misbehave. Add a button to reset it.-->
<input type="button" value="Clear Writeup" onclick="if (confirm('Are you sure you want to clear the writeup?')) {quill.root.innerHTML = '';UpdateWriteup()}">
<div id="editor-container" style="height: fit-content; max-height:80vh; min-height:150px;"></div>
<br>



<br><br><br>
<input type="button" value="Copy Output To Clipboard" onclick="copyStringToClipboard()">
<textarea id="Output" readonly="" placeholder="Output Will Appear Here. Copy and Paste it into the Google Doc."rows = "25" style="width:100%"></textarea>
<br>


<script src="quill.min.js"></script>
<link rel="stylesheet" type="text/css" href="quill.snow.css">
<script>
function copyStringToClipboard() {
   var str = document.getElementById("Output").value
   // Create new element
   var el = document.createElement('textarea');
   // Set value (string to be copied)
   el.value = str;
   // Set non-editable to avoid focus and move outside of view
   el.setAttribute('readonly', '');
   el.style = {position: 'absolute', left: '-9999px'};
   document.body.appendChild(el);
   // Select text inside element
   el.select();
   // Copy text to clipboard
   document.execCommand('copy');
   // Remove temporary element
   document.body.removeChild(el);
}




//Create writeup editor
var toolbarOptions = [
    ['bold', 'italic', 'underline', 'strike'],
    ['blockquote'],

    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
    [{ 'script': 'sub'}, { 'script': 'super' }],

    [{ 'header': [1, 2, 3, 4, 5, 6, false] }],

    [ 'link', 'image', 'video'], //Image and video handlers are overwritten.
    //[{ 'color': [] }, { 'background': [] }], //CSP breaks inline style.

    ['clean']
];

var quill = new Quill('#editor-container', {
modules: {
toolbar: toolbarOptions
},
placeholder: 'Create your writeup...',
theme: 'snow'
});

quill.on('text-change', function() {
    UpdateWriteup()
});

let API_KEY = "AIzaSyD-MaLfNzz1BiUvdKKfowXbmW_v8E-9xSc"

quill.getModule("toolbar").handlers.image = function imageHandler(value) {
        let File_ID = prompt("Please type in the File ID of the image in Google Drive. (To get the file id, click on the file, click the three dot menu in the top right hand corner, click open in new window. Copy out the section between /d/ and /view).")
        quill.insertEmbed(quill.getSelection(true), 'image', 'https://www.googleapis.com/drive/v3/files/' + File_ID + '?alt=media&key=' + API_KEY);
}

quill.getModule("toolbar").handlers.video = function imageHandler(value) {
        let File_ID = prompt("Please type in the File ID of the video in Google Drive. (To get the file id, click on the file, click the three dot menu in the top right hand corner, click open in new window. Copy out the section between /d/ and /view).")
        quill.insertEmbed(quill.getSelection(true), 'video', 'https://www.googleapis.com/drive/v3/files/' + File_ID + '?alt=media&key=' + API_KEY);
}

var List = ["name","section","skill","rating","writeup","tags","usgs","aw","plat","plon","tlat","tlon","hidlat","hidlon","maxrun","minrun","lowflow","medflow","highflow","dam","virtualgauge","relatedusgs","class"]

List.forEach(function(value){
  console.log(value)
  console.log(document.getElementById(value))
  if (value !== "writeup") {
      document.getElementById(value).value = localStorage.getItem(value)
      document.getElementById(value).addEventListener("keyup", UpdateWriteup)
  }
  else {
      //Start quill off with stored value.
      quill.root.innerHTML = localStorage.getItem(value)
  }
})


	function toDecimalDegrees(coord) {
	if (!isNaN(Number(coord))) {
		return coord //Coordinate is already in decimal form.
	}

	let parts = coord.split(/[^\w]+/) //Split on non-alphanumeric characters.
	console.log(parts)
	let direction;
	for (let i=0;i<parts.length;i++) {
		if (["N","S","E","W"].includes(parts[i])) {
			direction = parts[i];
			parts.splice(i, 1)
			break;
		}
	}
	console.log(parts)
	let degrees = Number(parts[0])
	let minutes = Number(parts[1] || 0)
	let seconds = Number(parts[2] || 0)

	minutes += seconds/60
	degrees += minutes/60

	return degrees
}

	function convertCoordinates() {
		["tlat", "tlon", "plat", "plon"].forEach(function(value) {
			let coordinate = document.getElementById(value).value.trim()
			document.getElementById(value).value = toDecimalDegrees(coordinate)
		})
	}

function UpdateWriteup() {

    List.forEach(function(value){
        if (value !== "writeup") {
            localStorage.setItem(value, document.getElementById(value).value.trim())
        }
        else {
            //Save quill to localStorage
            localStorage.setItem(value, quill.root.innerHTML)
        }
    })

    var Text = ""
    var EndText = ""
    List.forEach(function(value, index){
      if (value === "writeup") {
          Text += "\n" + value + ": " + quill.root.innerHTML
      }
      else if (value === "relatedusgs") {
          Text += "\n" + value + ": "
          //Convert comma seperated list into javascript list
          if (document.getElementById(value).value.trim().split(" ").join("").split(",").length > 0) {
              Text += JSON.stringify(document.getElementById(value).value.trim().split(" ").join("").split(","))
          }
      }
      else {
          Text += "\n" + value + ": " + document.getElementById(value).value.trim()
      }
    })

	Text.trim()

    document.getElementById("Output").value = Text
}
UpdateWriteup()
//Initial update
</script>

<script src="../packages/allPages.js"></script>
