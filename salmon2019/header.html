<html>
	<head>
		<title>Middle Fork Salmon 2019 Pictures</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
<body>
<h1>Middle Fork Salmon 2019 Pictures</h1>
<style>
h1 {
        text-align: center;
}
	@media (prefers-color-scheme: dark) {
		html, body {
			background-color: black;
			color: white;
		}
	}
</style>
			<script src="https://rivers.run/packages/allPages.js"></script>
<button id="createdir">Create Directory</button>
	<button id="downloadzipdir">Download Directory as .Zip</button>
<input id="uploadfiles" type="file" multiple accept="*">
	<script>
		
		let postURL = "https://rivers.run/node/salmon2019/"
		postURL += window.location.pathname.slice("/salmon2019/".length)
		
		//Download as Zip Button
		let dirname = window.location.pathname.slice(window.location.pathname.lastIndexOf("/") + 1)
		let downloadAsZip = document.getElementById("downloadzipdir")
		downloadAsZip.download = dirname
		downloadAsZip.href = postURL
		
		
		
	//Create directory button.
	document.getElementById("createdir").addEventListener("click", async function() {
			let dirname = prompt("What would you like the name of the directory to be?")
		    let result = await fetch(postURL + dirname + "/", {
                cache: "no-store",
                method: "POST"
            })
			alert(await result.text())
			window.location.reload()
	})
		
		let total;
		let filecount = 0
		let finished = 0
		let previousHTML;
		
async function handlefiles(files) {
    //If we got a list of files, iterate through the list recursively.
    if (files instanceof FileList) {
        for (var i=0;i<files.length;i++) {
            await handlefiles(files[i])
        }
    }
    else {    
		
		filecount++
		let filenum = filecount		
		
		if (previousHTML.includes(files.name)) {
			//Don't bother uploading a file if it is already in the directory listing (because the server will reject it.)
			document.write("File " + filenum + " already exists.<br>")
		}
		else {
		
			document.write("Uploading file " + filenum + "<br>")

		    let result = await fetch(postURL + files.name, {
                cache: "no-store",
                method: "POST",
				body: files
            })
			
			document.write("File " + filenum + ": " + await result.text() + "<br>")
		}
		
		finished++
		if (finished === total) {window.location.reload()}
	}
}
    
		
		
document.getElementById("uploadfiles").addEventListener("change", function(){
	if (confirm("Are you sure you want to upload " + this.files.length + " files?")) {
		previousHTML = document.body.innerHTML
		console.log(this.files)
		handlefiles(this.files)
		total = this.files.length
	}
})
	</script>